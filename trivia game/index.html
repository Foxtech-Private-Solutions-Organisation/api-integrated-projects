<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Multiplayer Trivia — OpenTDB</title>
    <style>
        :root {
            --bg: #0f1115;
            --panel: #171a21;
            --muted: #d4d9e6;
            --text: #e6e9f2;
            --brand: #ff9d00;
            --brand-2: #ffb340;
            --ok: #00c853;
            --bad: #ff5252;
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
            background: radial-gradient(1200px 600px at 10% -10%, #1b2030 0, #0f1115 50%, #0b0d12 100%);
            color: var(--text);
            min-height: 100dvh;
            display: grid;
            place-items: start center;
            padding: 24px;
        }

        .wrap {
            width: min(960px, 100%);
        }

        .card {
            background: linear-gradient(180deg, #171a21cc, #141821ee);
            border: 1px solid #222739;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, .35);
            backdrop-filter: blur(6px);
        }

        h1 {
            margin: 0 0 10px;
            font-size: clamp(22px, 3.5vw, 34px);
            color: var(--brand);
            letter-spacing: .3px
        }

        .row {
            display: grid;
            gap: 12px;
            grid-template-columns: repeat(12, 1fr);
            align-items: center
        }

        .row>* {
            grid-column: span 12
        }

        @media (min-width: 780px) {
            .row--grid>* {
                grid-column: span 4
            }

            .row--grid .wide {
                grid-column: span 8
            }
        }

        label {
            font-size: 13px;
            color: var(--muted)
        }

        input,
        select,
        button {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid #2a3045;
            background: #0f1320;
            color: var(--text);
            outline: none;
        }

        input::placeholder {
            color: #6f7b99
        }

        button {
            background: linear-gradient(180deg, var(--brand), var(--brand-2));
            color: #ffffff;
            font-weight: 700;
            border: none;
            cursor: pointer;
            transition: transform .08s ease, filter .2s ease;
        }

        button:hover {
            filter: brightness(1.05)
        }

        button:active {
            transform: translateY(1px)
        }

        .ghost {
            background: #1a2030;
            color: var(--text);
            border: 1px solid #2a3045
        }

        .stack {
            display: grid;
            gap: 12px
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 10px;
            border-radius: 999px;
            background: #0e1422;
            border: 1px solid #27324a;
            font-size: 12px;
            color: var(--muted)
        }

        /* Quiz layout */
        .quiz {
            margin-top: 18px;
            display: grid;
            gap: 14px
        }

        .q {
            padding: 18px;
            border-radius: 12px;
            background: #111624;
            border: 1px solid #233055;
            font-size: clamp(16px, 2vw, 20px);
            line-height: 1.4;
        }

        .answers {
            display: grid;
            gap: 10px
        }

        .answer {
            padding: 12px 14px;
            border-radius: 12px;
            background: #0f1320;
            border: 1px solid #2a3045;
            cursor: pointer;
            transition: background .2s ease, transform .05s ease, border-color .2s ease;
        }

        .answer:hover {
            background: #131a2d;
            border-color: #3a4670
        }

        .answer:active {
            transform: translateY(1px)
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            justify-content: space-between
        }

        .turn {
            font-weight: 700;
            color: var(--brand)
        }

        .scoreboard {
            display: grid;
            gap: 8px;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr))
        }

        .score {
            background: #0e1422;
            border: 1px solid #27324a;
            border-radius: 12px;
            padding: 10px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px
        }

        .score .n {
            font-weight: 700
        }

        .score .v {
            font-variant-numeric: tabular-nums
        }

        .muted {
            color: var(--muted)
        }

        /* Modal */
        .modal {
            position: fixed;
            inset: 0;
            display: none;
            place-items: center;
            background: rgba(9, 10, 15, .6);
            z-index: 50;
            animation: fade .15s ease;
        }

        @keyframes fade {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .modal .panel {
            width: min(520px, 92%);
            background: #12182a;
            border: 1px solid #283556;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 20px 70px rgba(0, 0, 0, .45);
        }

        .modal h2 {
            margin: 0 0 6px;
            color: var(--brand)
        }

        .ok {
            color: var(--ok)
        }

        .bad {
            color: var(--bad)
        }

        .sp {
            height: 26px;
            width: 26px;
            border: 3px solid #2b3655;
            border-top-color: var(--brand);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-inline: auto
        }

        @keyframes spin {
            to {
                transform: rotate(360deg)
            }
        }

        .sep {
            height: 1px;
            background: #222941;
            margin: 14px 0
        }
    </style>
</head>

<body>
    <div class="wrap card">
        <h1>🎮 Multiplayer Trivia</h1>
        <div class="row row--grid">
            <div>
                <label>Players (2–6)</label>
                <select id="playerCount">
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                    <option>5</option>
                    <option>6</option>
                </select>
            </div>
            <div class="wide">
                <label>Player Names (comma separated)</label>
                <input id="playerNames" placeholder="e.g. Alex, Sam, Priya, Lee" />
            </div>
            <div>
                <label>Questions</label>
                <select id="amount">
                    <option>10</option>
                    <option selected>15</option>
                    <option>20</option>
                    <option>25</option>
                </select>
            </div>
            <div>
                <label>Difficulty</label>
                <select id="difficulty">
                    <option value="">Any</option>
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>
            <div class="wide">
                <label>Category</label>
                <select id="category">
                    <option value="">Any</option>
                    <option value="9">General Knowledge</option>
                    <option value="18">Science: Computers</option>
                    <option value="17">Science & Nature</option>
                    <option value="30">Science: Gadgets</option>
                    <option value="22">Geography</option>
                    <option value="23">History</option>
                    <option value="21">Sports</option>
                    <option value="11">Entertainment: Film</option>
                    <option value="12">Entertainment: Music</option>
                    <option value="14">Entertainment: Television</option>
                    <option value="15">Entertainment: Video Games</option>
                    <option value="16">Entertainment: Board Games</option>
                    <option value="10">Entertainment: Books</option>
                    <option value="31">Entertainment: Anime & Manga</option>
                    <option value="32">Entertainment: Cartoon & Animations</option>
                    <option value="20">Mythology</option>
                    <option value="27">Animals</option>
                    <option value="28">Vehicles</option>
                    <option value="25">Art</option>
                    <option value="24">Politics</option>
                    <option value="29">Comics</option>
                </select>
            </div>
            <div><label>&nbsp;</label><button id="startBtn">Start Game</button></div>
        </div>

        <div class="sep"></div>

        <div class="stack">
            <div class="meta">
                <div class="pill"><span>Turn:</span> <strong id="turn" class="turn">–</strong></div>
                <div class="pill"><span>Progress:</span> <strong id="progress">0 / 0</strong></div>
                <div class="pill"><span>Difficulty:</span> <strong id="diffShow">Any</strong></div>
            </div>

            <div id="quiz" class="quiz" style="display:none">
                <div id="q" class="q">Loading question…</div>
                <div id="answers" class="answers"></div>
                <div class="meta">
                    <button class="ghost" id="skipBtn" title="Skip the current question (no score change)">Skip
                        Question</button>
                    <span class="muted" id="helpText">Choose the correct answer.</span>
                </div>
            </div>

            <div>
                <h3>Scoreboard</h3>
                <div id="scores" class="scoreboard"></div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle"
        aria-describedby="modalMsg">
        <div class="panel">
            <h2 id="modalTitle">Title</h2>
            <p id="modalMsg" class="muted">Message</p>
            <div id="modalExtra" class="muted" style="margin:8px 0 14px"></div>
            <button id="modalBtn">Continue</button>
        </div>
    </div>

    <script>
        (() => {
            let players = [];
            let currentPlayerIdx = 0;
            let questions = [];
            let qi = 0;
            let desiredAmount = 15;
            let fetching = false;

            const $ = s => document.querySelector(s);
            const htmlDecode = (str) => { const t = document.createElement('textarea'); t.innerHTML = str; return t.value; };
            const shuffle = (arr) => arr.map(v => [Math.random(), v]).sort((a, b) => a[0] - b[0]).map(v => v[1]);

            function showModal(title, msg, extraHTML = "", btn = "OK") {
                $("#modalTitle").textContent = title;
                $("#modalMsg").innerHTML = msg;
                $("#modalExtra").innerHTML = extraHTML;
                $("#modalBtn").textContent = btn;
                $("#modal").style.display = "grid";
                return new Promise(res => {
                    const handler = () => { $("#modal").style.display = "none"; $("#modalBtn").removeEventListener('click', handler); res(); };
                    $("#modalBtn").addEventListener('click', handler);
                });
            }

            function spinner(msg = "Loading…") {
                return `<div class="sp" aria-hidden="true"></div><div style="margin-top:8px">${msg}</div>`;
            }

            function renderScores() {
                const s = $("#scores");
                s.innerHTML = players.map((p, i) => `
      <div class="score">
        <span class="n">P${i + 1}: ${p.name}</span>
        <span class="v">⭐ ${p.score}</span>
      </div>
    `).join("");
                $("#turn").textContent = `${players[currentPlayerIdx]?.name ?? "–"} (P${currentPlayerIdx + 1})`;
                $("#progress").textContent = `${Math.min(qi, questions.length)} / ${desiredAmount}`;
            }

            function renderQuestion() {
                if (qi >= desiredAmount || qi >= questions.length) {
                    const max = Math.max(...players.map(p => p.score));
                    const winners = players.filter(p => p.score === max).map(p => p.name);
                    const table = players.map(p => `<div>• ${p.name}: <strong>${p.score}</strong></div>`).join("");
                    showModal("🏁 Game Over", winners.length > 1 ? `Winners: <strong>${winners.join(", ")}</strong>` : `Winner: <strong>${winners[0]}</strong>`, `<div class="sep"></div>${table}`, "Play Again").then(() => {
                        $("#quiz").style.display = "none";
                        $("#helpText").textContent = "Choose the correct answer.";
                    });
                    return;
                }
                const q = questions[qi];
                $("#quiz").style.display = "grid";
                $("#q").innerHTML = htmlDecode(q.question);
                const answers = shuffle([q.correct, ...q.incorrect]);
                $("#answers").innerHTML = answers.map(a => `<button class="answer" data-a="${encodeURIComponent(a)}">${htmlDecode(a)}</button>`).join("");
                $("#helpText").textContent = `Player ${currentPlayerIdx + 1} (${players[currentPlayerIdx].name}), it's your turn.`;
                $("#diffShow").textContent = q.difficulty[0].toUpperCase() + q.difficulty.slice(1);
            }

            function nextTurn() { currentPlayerIdx = (currentPlayerIdx + 1) % players.length; }

            async function startGame() {
                if (fetching) return;

                const count = Math.min(6, Math.max(2, parseInt($("#playerCount").value || "2", 10)));
                desiredAmount = parseInt($("#amount").value || "15", 10);

                let names = ($("#playerNames").value || "").split(",").map(s => s.trim()).filter(Boolean);
                if (names.length < count) {
                    const defaults = ["Alex", "Sam", "Priya", "Lee", "Maya", "Ravi", "Zoe", "Liam", "Ava", "Noah"];
                    while (names.length < count) names.push(defaults[names.length % defaults.length]);
                } else if (names.length > count) { names = names.slice(0, count); }

                players = names.map(n => ({ name: n, score: 0 }));
                currentPlayerIdx = 0; qi = 0;
                renderScores();

                const category = $("#category").value;
                const difficulty = $("#difficulty").value;
                const base = new URL("https://opentdb.com/api.php");
                base.searchParams.set("amount", Math.max(desiredAmount * 2, 24));
                base.searchParams.set("type", "multiple");
                if (category) base.searchParams.set("category", category);
                if (difficulty) base.searchParams.set("difficulty", difficulty);

                fetching = true;
                $("#q").innerHTML = spinner("Fetching questions…");
                $("#answers").innerHTML = "";
                try {
                    const res = await fetch(base.toString());
                    const data = await res.json();
                    const raw = Array.isArray(data.results) ? data.results : [];
                    questions = raw.map(r => ({
                        question: r.question,
                        correct: r.correct_answer,
                        incorrect: r.incorrect_answers,
                        difficulty: r.difficulty || "any",
                        category: r.category || "General"
                    })).slice(0, desiredAmount);

                    if (questions.length === 0) {
                        await showModal("No questions found", "Please choose a different category/difficulty.");
                        fetching = false; return;
                    }

                    renderScores();
                    renderQuestion();
                } catch (e) {
                    console.error(e);
                    await showModal("Network error", "Couldn’t fetch questions. Please check your connection and try again.");
                } finally { fetching = false; }
            }

            async function handleAnswer(target) {
                const btn = target.closest(".answer");
                if (!btn) return;
                const selected = decodeURIComponent(btn.dataset.a || "");
                const q = questions[qi];
                const correct = selected === q.correct;
                if (correct) {
                    players[currentPlayerIdx].score += 1;
                    renderScores();
                    await showModal("✅ Correct!", `<span class="ok">Nice one, ${players[currentPlayerIdx].name}!</span>`);
                } else {
                    await showModal("❌ Incorrect", `The correct answer was:<br><strong>${htmlDecode(q.correct)}</strong>`);
                }
                qi += 1; nextTurn(); renderScores(); renderQuestion();
            }

            async function skipQuestion() {
                await showModal("⏭️ Skipped", "No points gained or lost.");
                qi += 1; nextTurn(); renderScores(); renderQuestion();
            }

            $("#startBtn").addEventListener("click", startGame);
            $("#answers").addEventListener("click", (e) => handleAnswer(e.target));
            $("#skipBtn").addEventListener("click", skipQuestion);

            window.addEventListener("keydown", (e) => {
                if ($("#quiz").style.display === "none") return;
                const idx = ["1", "2", "3", "4"].indexOf(e.key);
                if (idx > -1) {
                    const btn = $("#answers").querySelectorAll(".answer")[idx];
                    if (btn) btn.click();
                }
            });
        })();
    </script>
</body>

</html>